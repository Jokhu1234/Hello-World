/*! For license information please see index.js.LICENSE.txt */
(()=>{var e={248:(e,t,n)=>{const{fireImpression:r}=n(148),{getAllExperiments:o,initialize:i,whenAvailable:a}=n(977),{ensureUserTestId:c}=n(548),s="TL6bJ6aeorhsvy5X8LGMVX",u=e=>`${c()}/${e}/${window.tracking?window.tracking.visit():"fixed-visit"}`;function l(e){window&&window.location&&window.location.search.match(/debug=true/g)&&console.log(`aa-experiment: ${e}`)}function d(e,t,n){try{const o=e.find((e=>e.experimentKey===t));if(o&&o.experimentKey&&o.variationKey){if(function(e,t){const n=localStorage.getItem(t);return!!n&&n===u(e)}(o.variationKey,n))return void l(`AA experiment already fired, clear ${n} in local storage for new impression`);r(o.experimentKey,o.variationKey,s).then((e=>{var t,r;e&&(t=o.variationKey,r=n,localStorage.setItem(r,u(t)))}))}else l("Not part of AA experiment, check you have the right whitelisted values")}catch(e){console.error(`Impression for ${t} failed`,e)}}function f(e){if(!e)return void l("ab-reader not available");const t=o();d(t,"metric_testing_aa","exp-aa-experiment"),d(t,"internal_aa","exp-aa-experiment-internal")}e.exports={impressionForAAExperiment:function(){i(),l("initialized, calling whenAvaialable"),a(f,5e3)}}},148:e=>{function t(e){return void 0!==e&&""!==e&&null!==e}e.exports.fireImpression=async function(e,n,r,o){if(!t(e)||!t(n)||!t(r))return console.error("ab-impression not well defined input parameter for the fireImpression method"),!1;let i=null;o&&(o.pageName&&o.pageSection&&o.pageStage?i=o:console.error("Page parameters format is wrong"));try{return await async function(e,t,n,r){let o={experimentName:e,variationName:t,nonInteraction:1,optimizelySdkKey:n,impressionEventVersion:2};function i(e){window.tracking.track("Experiment Viewed",e)}r&&(o={...o,pageName:r.pageName,pageSection:r.pageSection,pageStage:r.pageStage}),window&&window.tracking&&window.tracking.track?i(o):window.addEventListener("trackingReady",(function(){i(o)}))}(e,n,r,i),!0}catch(e){return console.error(`Error sending impression: ${e}`),!1}}},977:(e,t,n)=>{"use strict";function r(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function c(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))}function o(){var e;let t=null===(e=null===window||void 0===window?void 0:window.tracking)||void 0===e?void 0:e.visit();if(t)return t;const n=document.cookie.split(";").find((e=>e.trim().startsWith("visit")));return n&&(t=n.split("=")[1].trim()),t}n.r(t),n.d(t,{getAllExperiments:()=>v,getVariation:()=>p,initialize:()=>u,isAvailable:()=>d,whenAvailable:()=>h});const i=()=>(null===window||void 0===window?void 0:window.abReader)||{getVariation:()=>null,getAllExperiments:()=>[],isAvailable:()=>!1};let a={};const c=function(){const e=e=>r(this,void 0,void 0,(function*(){return yield fetch(function(e){let t="https://endpoint1.collection.us2.sumologic.com/receiver/v1/http/ZaVnC4dhaV0g2tKx_W3bClZ2AFy5A6Qm6p3SMABjYasCxtKOoSDSUz_J7rmKVIRxgRAJ6sn-OZjYmTbbdkGGD2lnWr9lIzj-sESQRQDX7x5h4Fxsp6nI4A==";return("localhost"===e||e.startsWith("staging"))&&(t="https://endpoint1.collection.us2.sumologic.com/receiver/v1/http/ZaVnC4dhaV0dMTNP6vKpR5bvfATTE9UlwwTguYtz4F6mtpERUrZ5IWyFvjfmUSj-M73Phbv7JURISTMzhN3nPelI7FG-hkH1yrugMm06jK193TF2hATLRw=="),t}(window.location.hostname),{method:"POST",body:e,headers:{"Content-Type":"text/plain"}})}));return{log:t=>r(this,void 0,void 0,(function*(){try{yield e("string"==typeof t?t:JSON.stringify(Object.assign(Object.assign({},t),{host:window.location.href,agent:window.navigator.userAgent,component:"ab-reader",visit:o(),version:"3.0.5"})))}catch(e){console.error("ab-reader failed sending logs",null==e?void 0:e.message)}}))}}(),s="ab-script-loaded",u=()=>{if(a={},m())return;if(window.abReaderInitialized)return;const e=document.createElement("script");e.type="application/javascript",e.async=!0,e.src=function(e){let t="https://wexp.exp.vpsvc.com/experimentation/ab-lib/ab-reader.js";try{let n=e.match(/vistaprint\.[a-z]{2,3}(\.[a-z]{2,3})?/);return n&&n[0]&&(t=`https://www.${n[0]}/experimentation/ab-lib/ab-reader.js`),("localhost"===e||e.startsWith("staging.vistaprint"))&&(t="https://staging.vistaprint.com/experimentation/ab-lib/ab-reader.js"),t}catch(n){return b({message:`There was an error trying to get the script source for the following hostname: '${e}'`}),t}}(window.location.hostname),e.onload=()=>window.dispatchEvent(new CustomEvent(s)),document.head.appendChild(e),window.abReaderInitialized=!0},l=(e,t,n)=>{try{return e()}catch(e){b({message:`ab-reader library failed when calling ${t}.`,error:JSON.stringify(e)})}return n},d=()=>!!g("isAvailable")&&f(),f=()=>l((()=>{var e,t;return null!==(t=null===(e=window.abReader)||void 0===e?void 0:e.isAvailable())&&void 0!==t&&t}),"isAvailable",!1),p=e=>w("getVariation",e)?l((()=>i().getVariation(e)),"getVariation",null):null,v=()=>w("getAllExperiments")?l(i().getAllExperiments,"getAllExperiments",[]):[],h=(e,t)=>{const n="variationsResolved",r=()=>{window.removeEventListener(n,r),e(f())},o=()=>{window.removeEventListener(s,o),f()?e(!0):i()},i=()=>{var e;window.addEventListener(n,r),t&&(e=t,new Promise((t=>{setTimeout(t,e)}))).then((()=>{r()}))};f()?e(!0):window.abReader?i():window.addEventListener(s,o)},m=()=>"undefined"==typeof window,g=(e,t)=>{if(m())return!1;const n=t?` with experiment key [${t}]`:"";return!!window.abReaderInitialized||(b({message:`Library not initialized before using method ${e}${n}.`}),!1)},w=(e,t)=>{if(!g(e,t))return!1;const n=t?` with experiment key [${t}]`:"";return void 0!==window.abReader||(b({message:`ab-reader library not ready before using method ${e}${n}.`}),!1)};function b(e){const t="string"==typeof e?e:e.message;a[t]||(c.log(e),a[t]=1)}},548:(e,t,n)=>{const r=n(378),o=n(614),i=n(849),a=new(n(178))(r.set,r.get,o.v4,i.getRootCookieDomain);e.exports={ensureUserTestId:()=>a.ensureUserTestId()}},178:e=>{const t="optimizelyEndUserId";function n(e,t,n,r){this.setCookie=e,this.getCookie=t,this.getUuid=n,this.getRootCookieDomain=r}n.prototype.ensureUserTestId=function(){var e=this.getCookie(t);if(e)return e;e=this.getUuid();const n={domain:this.getRootCookieDomain(),expires:180};return this.setCookie(t,e,n),e},e.exports=n},849:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getCurrentDomain:()=>m,getCurrentTenant:()=>d,getCurrentTenantOrDefault:()=>l,getRootCookieDomain:()=>g});const r=function(){var e=window&&window.location&&window.location.hostname;if(!e||0===e.length)throw new Error("Hostname could not be determined for the current document.");return e},o=function(){var e=window&&window.document;if(!e)throw new Error("DOM document could not be determined.");return e};var i="vistaprint",a="promotique",c=[i,"vista",a],s=["masken","mondkapjes","masks","masker","maskit","masque","mascherine","munnbind","mascaras","mascarillas","munskydd"],u=["touch-free-payments"],l=function(e){var t=window&&window.location&&window.location.pathname;if(t&&"/"!==t)for(var n=t.split("/"),o=0;o<n.length;o+=1){if(-1!==s.indexOf(n[o].toLowerCase()))return"masks";if(-1!==u.indexOf(n[o].toLowerCase()))return"paypal"}var l=r().split(".").slice(-3);if(l[0]&&"brandstore"===l[0].toLocaleLowerCase()&&l[1]===i)return a;if(l[0]&&"novelty"===l[0].toLocaleLowerCase()&&l[1]===i)return a;for(var d=l.length-1;d>=0;d-=1)if(-1!==c.indexOf(l[d]))return l[d];return e},d=function(){return l(i)},f="top_level_domain_resolution",p=null,v=function(e,t,n,r){var i=n.toUTCString();o().cookie=e+"="+t+";expires="+i+";path=/;domain="+r},h=function(){var e,t,n,i=r().split("."),a=new Date;a.setTime(a.getTime()+5e3);for(var c=i.length-1;c>=0;c-=1){var s=i.slice(c).join(".");if(v(f,"1",a,s),o().cookie.indexOf(f)>-1)return e=f,t=s,void 0,n=new Date(1970),v(e,"",n,t),s}return null},m=function(){return p||(p=h())},g=function(){var e=h();if(e&&"localhost"!==e)return new RegExp(/^[0-9.]+$/).test(e)?e:"."+e}},506:(e,t,n)=>{const r=n(378),{deserialize:o,deserializeCF:i}=n(630),a="puc-ctc",c="userContext",s=()=>{const e=r.get(c);if(!e){const e=r.get(a);return e?o(e):(console.warn("ctc-reader: Context cookie are missing. If you are developing locally check the readme;)"),[])}return i(e)};function u(){try{return!!r.get(c)||!!r.get(a)}catch(e){return console.warn("ctc-reader in isAvailable failed.",e),!1}}e.exports={isTreatmentEnabled:e=>{try{return s().includes(e)}catch(e){console.warn("ctc-reader in isTreatmentEnabled failed.",e)}},getAllTreatments:()=>{try{return s()}catch(e){return console.warn("ctc-reader in getAllTreatments failed.",e),[]}},isAvailable:u,whenAvailable:function(e){const t=()=>{window.removeEventListener("treatmentsResolved",t),e()};u()?e():window.addEventListener("treatmentsResolved",t)}}},630:e=>{e.exports.deserialize=e=>e.split(",").map((e=>e.trim())).filter((e=>""!=e)),e.exports.deserializeCF=e=>{const t=JSON.parse(decodeURIComponent(e));return t.ctc&&t.ctc.v1?t.ctc.v1:[]}},844:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getCurrentCountry:()=>c,getCurrentCulture:()=>a});var r=function(){var e=("undefined"!=typeof window?window.location:void 0)&&window.location.hostname;if(!e||0===e.length)throw new Error("Hostname could not be determined for the current document.");return e},o=function(){return("undefined"!=typeof window?window.location:void 0)&&window.location.pathname||"/"},i=function(e,t){switch(("localhost"===e?"IE":"vista.com"===e?"/"===t?"us":t.substr(1,2):function(e){if(!e||0===e.length)throw new Error("Domain must be specified");var t=e.split(".");if(t.length<2)throw new Error("Domain '"+e+"' does hot have the right format.");return t.pop()}(e)).toLowerCase()){case"pt":return"PT";case"ie":return"IE";case"es":return"ES";case"in":return"IN";case"jp":return"JP";case"com":case"us":return"US";case"fr":return"FR";case"it":return"IT";case"uk":return"GB";case"de":return"DE";case"nl":return"NL";case"dk":return"DK";case"se":return"SE";case"at":return"AT";case"no":return"NO";case"fi":return"FI";case"be":return"BE";case"sg":return"SG";case"nz":return"NZ";case"au":return"AU";case"ca":return"CA";case"ch":return"CH"}throw new Error("Unknown country for host "+e+" and path "+t)},a=function(){return function(e,t){var n;switch(i(e,t).toUpperCase()){case"PT":return"pt-PT";case"IE":return"en-IE";case"ES":return"es-ES";case"IN":return"en-IN";case"US":return(n=t.toLowerCase()).startsWith("/es")||n.startsWith("/us/es")?"es-US":"en-US";case"GB":return"en-GB";case"FR":return"fr-FR";case"IT":return"it-IT";case"DE":return"de-DE";case"NL":return"nl-NL";case"DK":return"da-DK";case"SE":return"sv-SE";case"AT":return"de-AT";case"NO":return"nb-NO";case"FI":return"fi-FI";case"BE":return function(e){var t=e.toLowerCase();return t.startsWith("/fr")||t.startsWith("/fr-be")?"fr-BE":"nl-BE"}(t);case"SG":return"en-SG";case"JP":return"ja-JP";case"NZ":return"en-NZ";case"AU":return"en-AU";case"CA":return function(e){var t=e.toLowerCase();return t.startsWith("/fr")||t.startsWith("/ca/fr")?"fr-CA":"en-CA"}(t);case"CH":return function(e){var t=e.toLowerCase();return t.startsWith("/fr")?"fr-CH":t.startsWith("/it")?"it-CH":"de-CH"}(t)}throw new Error("Unknown culture for host "+e+" and path "+t)}(r(),o())},c=function(){var e=r(),t=o();return i(e,t)}},242:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getCurrentDomain:()=>m,getCurrentTenant:()=>d,getRootCookieDomain:()=>g});const r=function(){var e=window&&window.location&&window.location.hostname;if(!e||0===e.length)throw new Error("Hostname could not be determined for the current document.");return e},o=function(){var e=window&&window.document;if(!e)throw new Error("DOM document could not be determined.");return e};var i="vistaprint",a="promotique",c={vistaprint:i,vpsvc:i,localhost:i,vista:"vista",promotique:a},s=["brandstore.vistaprint.in","novelty.vistaprint.jp"],u=["masken","mondkapjes","masks","masker","maskit","masque","mascherine","munnbind","mascaras","mascarillas","munskydd"],l=["touch-free-payments"],d=function(){return function(e,t){if(t&&"/"!==t)for(var n=t.split("/"),r=0;r<n.length;r+=1){if(-1!==u.indexOf(n[r].toLowerCase()))return"masks";if(-1!==l.indexOf(n[r].toLowerCase()))return"paypal"}for(var o=e.split(".").slice(-3),i=0,d=s;i<d.length;i++){var f=d[i];if(e.endsWith(f))return a}for(var p=o.length-1;p>=0;p-=1)if(null!=c[o[p]])return c[o[p]];throw new Error("Could not resolve tenant for host "+e+" and path "+t)}(r(),window&&window.location&&window.location.pathname)},f="top_level_domain_resolution",p=null,v=function(e,t,n,r){var i=n.toUTCString();o().cookie=e+"="+t+";expires="+i+";path=/;domain="+r},h=function(){var e,t,n,i=r().split("."),a=new Date;a.setTime(a.getTime()+5e3);for(var c=i.length-1;c>=0;c-=1){var s=i.slice(c).join(".");if(v(f,"1",a,s),o().cookie.indexOf(f)>-1)return e=f,t=s,void 0,n=new Date(1970),v(e,"",n,t),s}return null},m=function(){return p||(p=h())},g=function(){var e=h();if(e&&"localhost"!==e)return new RegExp(/^[0-9.]+$/).test(e)?e:"."+e}},765:(e,t,n)=>{const r=n(378),{deserialize:o,deserializeCF:i}=n(170),a="puc-up",c="userContext",s=()=>{const e=r.get(c);if(!e){const e=r.get(a);return e?o(e):(console.warn("up-reader: Context cookie are missing. If you are developing locally check the readme;)"),{})}return i(e)};e.exports={getTrait:e=>{try{return s()[e]}catch(e){console.warn("up-reader in getTrait failed.",e)}},getAllTraits:()=>{try{return s()}catch(e){return console.warn("up-reader in getAllTraits failed.",e),{}}},isAvailable:function(){try{return!!r.get(c)||!!r.get(a)}catch(e){return console.warn("up-reader in isAvailable failed.",e),!1}}}},170:e=>{e.exports.deserialize=e=>{const t={};return decodeURIComponent(e).split(",").map((e=>e.trim())).filter((e=>""!=e)).forEach((n=>{const r=n.split(":");if(2!=r.length)throw new Error("malformed puc-up cookie",e);t[r[0]]=r[1]})),t},e.exports.deserializeCF=e=>{const t=JSON.parse(decodeURIComponent(e));return t.userProfile&&t.userProfile.v1?t.userProfile.v1:{}}},394:(e,t,n)=>{var r=n(986).setPermanentCookie;e.exports={setCanonicalId:function(e){var t=window&&window.vp&&window.vp.auth&&window.vp.auth.cache&&window.vp.auth.cache.canonicalId;t&&(e.addCommonData({canonicalId:t}),r("uc_id",t))}}},144:(e,t,n)=>{"use strict";function r(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}var o=v((function(e){var t=h(),n=[],r=Object.keys(t).filter((function(e){return e.startsWith("userContext")||e.startsWith("uc")})).map((function(e){return t[e].length+e.length})).reduce((function(e,t){return e+t}),0),o=Object.keys(t).map((function(e){return t[e].length+e.length})).reduce((function(e,t){return e+t}),0);return n.push({message:"Cookie size",allCookieSize:o,contextCookieSize:r}),f((function(){if(n.length)return u(e.logBatch(n))}))}));function i(){}var a=v((function(e){var t,n,o=!1,i=h("userContext");return t=function(t){return o?t:m(c((function(){JSON.parse(decodeURIComponent(i))}),(function(){return u(e.log({message:"Malformed context cookie",contextCookie:i}))})))},(n=function(){if(!i)return r(e.log({message:"Missing context cookie."}),(function(){o=!0}))}())&&n.then?n.then(t):t(n)}));function c(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}var s=v((function(e){var t=p();return e.addCommonData({culture:t,visitId:h("visit")}),m(c((function(){return r(o(e),(function(){return u(a(e))}))}),(function(t){return u(e.log({message:"Cloudflare logging failed",error:t.message}))})))}));function u(e,t){if(!t)return e&&e.then?e.then(i):Promise.resolve()}var l=v((function(e,t,n){return r(fetch(n,{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},method:"post"}),(function(e){return f((function(){if(200!==e.status){var n="";return a=function(){return u(t.log({message:"Cloudflare invocation failed on: ".concat(e.status,"."),body:n}))},(o=c((function(){return r(e.text(),(function(e){n=e}))}),i))&&o.then?o.then(a):a()}var o,a}))}))})),d=v((function(e,t,n,o){return c((function(){if(window&&window.location&&!window.location.hostname.includes("gallery."))return r(l(e,t,"https://".concat(window.location.hostname,"/context-update?requestor_url=").concat(encodeURIComponent(window.location.href),"&force_update=").concat(n,"&merge_canonical_id=").concat(o)),(function(){g("treatmentsResolved",w.getAllTreatments())}))}),(function(e){return u(t.log({message:"Cloudflare invocation failed on: ".concat(e.message,". ").concat(e)}))}))}));function f(e){var t=e();if(t&&t.then)return t.then(i)}var p=n(844).getCurrentCulture;function v(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}var h=n(986).getCookie;function m(e){if(e&&e.then)return e.then(i)}var g=n(319).publish,w=n(506);t.invokeCloudflare=d,t.monitorCloudflarePerformance=s},986:(e,t,n)=>{"use strict";function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=n(242),a=n(808).withConverter({read:function(e,t){return decodeURIComponent(e)},write:function(e,t){return encodeURIComponent(e)}});e.exports={getCookie:function(e){return a.get(e)},deleteCookie:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a.remove(e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({path:"/"},t))},setPermanentCookie:function(e,t){var n=i.getRootCookieDomain();a.set(e,t,{domain:n,expires:30})}}},319:(e,t,n)=>{"use strict";var r=n(638);e.exports={publish:function(e,t){var n=new r(e,{detail:t});window.dispatchEvent(n)}}},468:(e,t,n)=>{"use strict";function r(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}var o=a((function(e){var t,n,o=!1,i=h.isTreatmentEnabled("site_tagging_new_customer"),a=h.isTreatmentEnabled("site_tagging_repeat_customer");return t=function(e){if(o)return e;var t=i?"New":"Repeat";window.localStorage.setItem("NewOrRepeat",t)},(n=function(){if(i===a)return r(e.log("new and repeat at the same time"),(function(){o=!0}))}())&&n.then?n.then(t):t(n)})),i=a((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(i,a){try{var s=(t=t||p(),u(t),r(f(e,t,!1,n),(function(){return m.initialize(),m.whenAvailable((function(e){v("variationsResolved",e?m.getAllExperiments():[])}),300),c(),r(o(t),(function(){return l(d(t))}))})))}catch(e){return a(e)}return s&&s.then?s.then(void 0,a):s}(0,(function(e){if(t)return l(t.log({message:"Failed on: ".concat(e,"."),error:e?e.message:"empty error"}));console.log("UCI initialize failed: ".concat(e,"."))}))}));function a(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}var c=n(248).impressionForAAExperiment;function s(){}var u=n(679).initReaders;function l(e,t){if(!t)return e&&e.then?e.then(s):Promise.resolve()}var d=n(144).monitorCloudflarePerformance,f=n(152).updateUserContext,p=n(26).initLogging,v=n(319).publish,h=n(506),m=n(977);e.exports.initialize=i,e.exports.updateUserContext=f},26:(e,t,n)=>{"use strict";function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=n(147).version;function c(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}var s={};function u(){}function l(e,t){if(!t)return e&&e.then?e.then(u):Promise.resolve()}function d(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}function f(e){if(e&&e.then)return e.then(u)}e.exports.initLogging=function(){var e=c((function(e){return fetch("https://endpoint1.collection.us2.sumologic.com/receiver/v1/http/ZaVnC4dhaV3EQ4nQYHTRNXvwIh7wG1qtDo1Cs-Od8UN-1Hh1VZY2ff5bs15kdkmq2i2SLnGbMI9iqBkIucyOxQP39Myz0rWW0WYb7LGdZaihjvO6IV9rCQ==",{method:"POST",body:e,headers:{"Content-Type":"text/plain"}})}));return{log:c((function(t){return f(d((function(){return l(e("string"==typeof t?t:JSON.stringify(o(o({},t),{},{host:window.location.hostname,agent:window.navigator.userAgent,component:"UCI",version:a},s))))}),(function(e){console.error("UCI failed",e?e.message:"")})))})),logBatch:c((function(t){var n=t.map((function(e){return JSON.stringify(o(o({},e),{},{component:"UCI",version:a}))}));return f(d((function(){return l(e(n.join("\n")))}),(function(e){console.error("UCI batch-log failed",e?e.message:"")})))})),addCommonData:function(e){s=o(o({},s),e)}}}},316:e=>{"use strict";e.exports.getValidToken=function(){try{var e=window.localStorage.getItem("vp-access-token");return null===e?null:JSON.parse(e).value}catch(e){return console.error("failure in UCI when parsing the token",e),null}}},152:(e,t,n)=>{"use strict";function r(){}var o,i=(o=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return function(e){if(e&&e.then)return e.then(r)}(function(r,i){try{var l=(t||(t=s()),u(t),a(c(e,t,n,o)))}catch(e){return i(e)}return l&&l.then?l.then(void 0,i):l}(0,(function(e){return a(t.log({message:"update context failed on: ".concat(e,".")}))})))},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(o.apply(this,e))}catch(e){return Promise.reject(e)}});function a(e,t){if(!t)return e&&e.then?e.then(r):Promise.resolve()}var c=n(144).invokeCloudflare,s=n(26).initLogging,u=n(394).setCanonicalId;e.exports.updateUserContext=i},679:(e,t,n)=>{"use strict";var r=n(506),o=n(765),i=n(319);e.exports.initReaders=function(){window.ctcReader=r,i.publish("ctcReaderReady"),window.upReader=o,i.publish("upReaderReady")}},638:(e,t,n)=>{var r=n.g.CustomEvent;e.exports=function(){try{var e=new r("cat",{detail:{foo:"bar"}});return"cat"===e.type&&"bar"===e.detail.foo}catch(e){}return!1}()?r:"undefined"!=typeof document&&"function"==typeof document.createEvent?function(e,t){var n=document.createEvent("CustomEvent");return t?n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail):n.initCustomEvent(e,!1,!1,void 0),n}:function(e,t){var n=document.createEventObject();return n.type=e,t?(n.bubbles=Boolean(t.bubbles),n.cancelable=Boolean(t.cancelable),n.detail=t.detail):(n.bubbles=!1,n.cancelable=!1,n.detail=void 0),n}},378:function(e,t){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)};function r(e,t){if(!t)return"";var n="; "+e;return!0===t?n:n+"="+t}function o(e,t,n){return encodeURIComponent(e).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/\(/g,"%28").replace(/\)/g,"%29")+"="+encodeURIComponent(t).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)+function(e){if("number"==typeof e.expires){var t=new Date;t.setMilliseconds(t.getMilliseconds()+864e5*e.expires),e.expires=t}return r("Expires",e.expires?e.expires.toUTCString():"")+r("Domain",e.domain)+r("Path",e.path)+r("Secure",e.secure)+r("SameSite",e.sameSite)}(n)}function i(e){for(var t={},n=e?e.split("; "):[],r=/(%[\dA-F]{2})+/gi,o=0;o<n.length;o++){var i=n[o].split("="),a=i.slice(1).join("=");'"'===a.charAt(0)&&(a=a.slice(1,-1));try{t[i[0].replace(r,decodeURIComponent)]=a.replace(r,decodeURIComponent)}catch(e){}}return t}function a(){return i(document.cookie)}function c(e,t,r){document.cookie=o(e,t,n({path:"/"},r))}t.__esModule=!0,t.encode=o,t.parse=i,t.getAll=a,t.get=function(e){return a()[e]},t.set=c,t.remove=function(e,t){c(e,"",n(n({},t),{expires:-1}))}},808:(e,t,n)=>{var r,o,i;void 0===(o="function"==typeof(r=i=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(r){function o(){}function i(t,n,i){if("undefined"!=typeof document){"number"==typeof(i=e({path:"/"},o.defaults,i)).expires&&(i.expires=new Date(1*new Date+864e5*i.expires)),i.expires=i.expires?i.expires.toUTCString():"";try{var a=JSON.stringify(n);/^[\{\[]/.test(a)&&(n=a)}catch(e){}n=r.write?r.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var c="";for(var s in i)i[s]&&(c+="; "+s,!0!==i[s]&&(c+="="+i[s].split(";")[0]));return document.cookie=t+"="+n+c}}function a(e,n){if("undefined"!=typeof document){for(var o={},i=document.cookie?document.cookie.split("; "):[],a=0;a<i.length;a++){var c=i[a].split("="),s=c.slice(1).join("=");n||'"'!==s.charAt(0)||(s=s.slice(1,-1));try{var u=t(c[0]);if(s=(r.read||r)(s,u)||t(s),n)try{s=JSON.parse(s)}catch(e){}if(o[u]=s,e===u)break}catch(e){}}return e?o[e]:o}}return o.set=i,o.get=function(e){return a(e,!1)},o.getJSON=function(e){return a(e,!0)},o.remove=function(t,n){i(t,"",e(n,{expires:-1}))},o.defaults={},o.withConverter=n,o}((function(){}))})?r.call(t,n,t,e):r)||(e.exports=o),e.exports=i()},614:(e,t,n)=>{"use strict";var r;n.r(t),n.d(t,{NIL:()=>S,parse:()=>m,stringify:()=>l,v1:()=>h,v3:()=>I,v4:()=>O,v5:()=>U,validate:()=>c,version:()=>R});var o=new Uint8Array(16);function i(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(o)}const a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,c=function(e){return"string"==typeof e&&a.test(e)};for(var s=[],u=0;u<256;++u)s.push((u+256).toString(16).substr(1));const l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]).toLowerCase();if(!c(n))throw TypeError("Stringified UUID is invalid");return n};var d,f,p=0,v=0;const h=function(e,t,n){var r=t&&n||0,o=t||new Array(16),a=(e=e||{}).node||d,c=void 0!==e.clockseq?e.clockseq:f;if(null==a||null==c){var s=e.random||(e.rng||i)();null==a&&(a=d=[1|s[0],s[1],s[2],s[3],s[4],s[5]]),null==c&&(c=f=16383&(s[6]<<8|s[7]))}var u=void 0!==e.msecs?e.msecs:Date.now(),h=void 0!==e.nsecs?e.nsecs:v+1,m=u-p+(h-v)/1e4;if(m<0&&void 0===e.clockseq&&(c=c+1&16383),(m<0||u>p)&&void 0===e.nsecs&&(h=0),h>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=u,v=h,f=c;var g=(1e4*(268435455&(u+=122192928e5))+h)%4294967296;o[r++]=g>>>24&255,o[r++]=g>>>16&255,o[r++]=g>>>8&255,o[r++]=255&g;var w=u/4294967296*1e4&268435455;o[r++]=w>>>8&255,o[r++]=255&w,o[r++]=w>>>24&15|16,o[r++]=w>>>16&255,o[r++]=c>>>8|128,o[r++]=255&c;for(var b=0;b<6;++b)o[r+b]=a[b];return t||l(o)},m=function(e){if(!c(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};function g(e,t,n){function r(e,r,o,i){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof r&&(r=m(r)),16!==r.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var a=new Uint8Array(16+e.length);if(a.set(r),a.set(e,r.length),(a=n(a))[6]=15&a[6]|t,a[8]=63&a[8]|128,o){i=i||0;for(var c=0;c<16;++c)o[i+c]=a[c];return o}return l(a)}try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}function w(e){return 14+(e+64>>>9<<4)+1}function b(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function y(e,t,n,r,o,i){return b((a=b(b(t,e),b(r,i)))<<(c=o)|a>>>32-c,n);var a,c}function C(e,t,n,r,o,i,a){return y(t&n|~t&r,e,t,o,i,a)}function x(e,t,n,r,o,i,a){return y(t&r|n&~r,e,t,o,i,a)}function k(e,t,n,r,o,i,a){return y(t^n^r,e,t,o,i,a)}function E(e,t,n,r,o,i,a){return y(n^(t|~r),e,t,o,i,a)}const I=g("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){for(var t=[],n=32*e.length,r="0123456789abcdef",o=0;o<n;o+=8){var i=e[o>>5]>>>o%32&255,a=parseInt(r.charAt(i>>>4&15)+r.charAt(15&i),16);t.push(a)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[w(t)-1]=t;for(var n=1732584193,r=-271733879,o=-1732584194,i=271733878,a=0;a<e.length;a+=16){var c=n,s=r,u=o,l=i;n=C(n,r,o,i,e[a],7,-680876936),i=C(i,n,r,o,e[a+1],12,-389564586),o=C(o,i,n,r,e[a+2],17,606105819),r=C(r,o,i,n,e[a+3],22,-1044525330),n=C(n,r,o,i,e[a+4],7,-176418897),i=C(i,n,r,o,e[a+5],12,1200080426),o=C(o,i,n,r,e[a+6],17,-1473231341),r=C(r,o,i,n,e[a+7],22,-45705983),n=C(n,r,o,i,e[a+8],7,1770035416),i=C(i,n,r,o,e[a+9],12,-1958414417),o=C(o,i,n,r,e[a+10],17,-42063),r=C(r,o,i,n,e[a+11],22,-1990404162),n=C(n,r,o,i,e[a+12],7,1804603682),i=C(i,n,r,o,e[a+13],12,-40341101),o=C(o,i,n,r,e[a+14],17,-1502002290),n=x(n,r=C(r,o,i,n,e[a+15],22,1236535329),o,i,e[a+1],5,-165796510),i=x(i,n,r,o,e[a+6],9,-1069501632),o=x(o,i,n,r,e[a+11],14,643717713),r=x(r,o,i,n,e[a],20,-373897302),n=x(n,r,o,i,e[a+5],5,-701558691),i=x(i,n,r,o,e[a+10],9,38016083),o=x(o,i,n,r,e[a+15],14,-660478335),r=x(r,o,i,n,e[a+4],20,-405537848),n=x(n,r,o,i,e[a+9],5,568446438),i=x(i,n,r,o,e[a+14],9,-1019803690),o=x(o,i,n,r,e[a+3],14,-187363961),r=x(r,o,i,n,e[a+8],20,1163531501),n=x(n,r,o,i,e[a+13],5,-1444681467),i=x(i,n,r,o,e[a+2],9,-51403784),o=x(o,i,n,r,e[a+7],14,1735328473),n=k(n,r=x(r,o,i,n,e[a+12],20,-1926607734),o,i,e[a+5],4,-378558),i=k(i,n,r,o,e[a+8],11,-2022574463),o=k(o,i,n,r,e[a+11],16,1839030562),r=k(r,o,i,n,e[a+14],23,-35309556),n=k(n,r,o,i,e[a+1],4,-1530992060),i=k(i,n,r,o,e[a+4],11,1272893353),o=k(o,i,n,r,e[a+7],16,-155497632),r=k(r,o,i,n,e[a+10],23,-1094730640),n=k(n,r,o,i,e[a+13],4,681279174),i=k(i,n,r,o,e[a],11,-358537222),o=k(o,i,n,r,e[a+3],16,-722521979),r=k(r,o,i,n,e[a+6],23,76029189),n=k(n,r,o,i,e[a+9],4,-640364487),i=k(i,n,r,o,e[a+12],11,-421815835),o=k(o,i,n,r,e[a+15],16,530742520),n=E(n,r=k(r,o,i,n,e[a+2],23,-995338651),o,i,e[a],6,-198630844),i=E(i,n,r,o,e[a+7],10,1126891415),o=E(o,i,n,r,e[a+14],15,-1416354905),r=E(r,o,i,n,e[a+5],21,-57434055),n=E(n,r,o,i,e[a+12],6,1700485571),i=E(i,n,r,o,e[a+3],10,-1894986606),o=E(o,i,n,r,e[a+10],15,-1051523),r=E(r,o,i,n,e[a+1],21,-2054922799),n=E(n,r,o,i,e[a+8],6,1873313359),i=E(i,n,r,o,e[a+15],10,-30611744),o=E(o,i,n,r,e[a+6],15,-1560198380),r=E(r,o,i,n,e[a+13],21,1309151649),n=E(n,r,o,i,e[a+4],6,-145523070),i=E(i,n,r,o,e[a+11],10,-1120210379),o=E(o,i,n,r,e[a+2],15,718787259),r=E(r,o,i,n,e[a+9],21,-343485551),n=b(n,c),r=b(r,s),o=b(o,u),i=b(i,l)}return[n,r,o,i]}(function(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(w(t)),r=0;r<t;r+=8)n[r>>5]|=(255&e[r/8])<<r%32;return n}(e),8*e.length))})),O=function(e,t,n){var r=(e=e||{}).random||(e.rng||i)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return l(r)};function A(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:case 3:return t^n^r;case 2:return t&n^t&r^n&r}}function j(e,t){return e<<t|e>>>32-t}const U=g("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var o=0;o<r.length;++o)e.push(r.charCodeAt(o))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var i=e.length/4+2,a=Math.ceil(i/16),c=new Array(a),s=0;s<a;++s){for(var u=new Uint32Array(16),l=0;l<16;++l)u[l]=e[64*s+4*l]<<24|e[64*s+4*l+1]<<16|e[64*s+4*l+2]<<8|e[64*s+4*l+3];c[s]=u}c[a-1][14]=8*(e.length-1)/Math.pow(2,32),c[a-1][14]=Math.floor(c[a-1][14]),c[a-1][15]=8*(e.length-1)&4294967295;for(var d=0;d<a;++d){for(var f=new Uint32Array(80),p=0;p<16;++p)f[p]=c[d][p];for(var v=16;v<80;++v)f[v]=j(f[v-3]^f[v-8]^f[v-14]^f[v-16],1);for(var h=n[0],m=n[1],g=n[2],w=n[3],b=n[4],y=0;y<80;++y){var C=Math.floor(y/20),x=j(h,5)+A(C,m,g,w)+b+t[C]+f[y]>>>0;b=w,w=g,g=j(m,30)>>>0,m=h,h=x}n[0]=n[0]+h>>>0,n[1]=n[1]+m>>>0,n[2]=n[2]+g>>>0,n[3]=n[3]+w>>>0,n[4]=n[4]+b>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]})),S="00000000-0000-0000-0000-000000000000",R=function(e){if(!c(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},147:e=>{"use strict";e.exports=JSON.parse('{"name":"@vp/user-context-initializer","version":"2.10.1","description":"","main":"./lib/main.js","files":["/lib"],"scripts":{"build":"webpack --mode production","build-npm":"babel src --out-dir lib --copy-files","test":"jest --forceExit ./test/**.spec.js","serve":"serve -l 3001 dist"},"repository":{"type":"git","url":"git+https://gitlab.com/vistaprint-org/personalization/starbug/common-infrastructure/user-context-initialiser.git"},"author":"","license":"ISC","devDependencies":{"@babel/cli":"^7.12.10","@babel/core":"^7.12.10","@babel/plugin-transform-classes":"^7.12.1","@babel/preset-env":"^7.12.11","@babel/runtime":"^7.12.5","@vp/browserslist-config-vp":"^2020.10.2","babel-jest":"^26.6.3","babel-loader":"^8.2.2","babel-plugin-transform-async-to-promises":"^0.8.15","babel-preset-minify":"^0.5.1","chai":"^4.3.4","clean-webpack-plugin":"^3.0.0","core-js":"^3.8.3","isomorphic-fetch":"^3.0.0","jest":"^26.6.3","nock":"^13.2.1","replace-in-file":"^6.2.0","serve":"^14.1.0","webpack":"^5.47.0","webpack-cli":"^4.9.2"},"dependencies":{"@vp/aa-experiment":"^1.1.2","@vp/ab-reader":"^3.0.5","@vp/ctc-reader":"^1.2.28","@vp/culture-resolution":"^2.0.81","@vp/tenant-resolution":"^2.0.39","@vp/up-reader":"^1.0.2","custom-event":"^1.0.1","js-cookie":"^2.2.1"},"jest":{"clearMocks":true,"testMatch":["**/test/**/*.js"]}}')}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e,t=n(468).initialize,r="userIdentity",o=n(316).getValidToken;(e=function(){var e=!1;return function(n,i){try{var a=function(){var n,i,a,c=o();return n=function(){if(null!==c)return n=t(c),r=function(){e=!0},o?r?r(n):n:(n&&n.then||(n=Promise.resolve(n)),r?n.then(r):n);var n,r,o},i=function(n){if(e)return n;window.addEventListener(r,(function e(n){var o=n.detail;o&&o.accessToken&&(window.removeEventListener(r,e),t(o.accessToken))}))},(a=n())&&a.then?a.then(i):i(a)}()}catch(e){return i(e)}return a&&a.then?a.then(void 0,i):a}(0,(function(e){console.error("user context initialization failed on: ".concat(e)),window.removeEventListener(r,handleIdentityUpdate)}))},function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}})()})()})();